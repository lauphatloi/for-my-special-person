<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Universe</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: #000;
            color: white;
            overflow-x: hidden; /* Prevent horizontal scroll */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* The 3D Canvas fixed in background */
        .webgl {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
            outline: none;
        }

        /* Scrollable Content Overlay */
        .content {
            position: relative;
            z-index: 2;
            height: 300vh; /* Make page long enough to scroll */
        }

        .scroll-prompt {
            position: absolute;
            bottom: 50px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            animation: bounce 2s infinite;
            pointer-events: none;
        }

        .final-message {
            position: absolute;
            top: 220vh; /* Appears at end of scroll */
            width: 100%;
            text-align: center;
            opacity: 0;
            transition: opacity 1s ease;
            pointer-events: none;
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            display: inline-block;
            max-width: 80%;
            border: 1px solid rgba(255,255,255,0.2);
            text-shadow: 0 2px 10px black;
        }

        h1 { font-size: 2rem; margin-bottom: 10px; color: #ff6030; }
        p { font-size: 1.2rem; line-height: 1.5; }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(10px); }
        }
    </style>
</head>
<body>

    <canvas class="webgl"></canvas>

    <div class="content">
        <div class="scroll-prompt">Scroll to explore</div>
        <div class="final-message" id="msg">
            <div class="card">
                <h1>For You</h1>
                <p>You are the brightest constellation in my galaxy.</p>
            </div>
        </div>
    </div>

    <!-- Import Map for Three.js modules -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.skypack.dev/three@0.132.2"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // 1. SETUP
        const canvas = document.querySelector('canvas.webgl');
        const scene = new THREE.Scene();

        // 2. CONFIGURATION
        const parameters = {
            count: 30000,          // Total stars (Keep reasonable for mobile)
            size: 0.15,            // Size of the image squares
            radius: 5,             // Size of galaxy
            branches: 3,
            spin: 1,
            randomness: 0.5,
            randomnessPower: 3,
            insideColor: '#ff6030', // Scorpio/Core Color
            outsideColor: '#1b3984' // Galaxy Arms Color
        };

        // 3. TEXTURE LOADER (YOUR IMAGE GOES HERE)
        const textureLoader = new THREE.TextureLoader();
        // ★★★ REPLACE THIS URL WITH YOUR IMAGE LINK ★★★
        // Use a square image for best results.
        const particleTexture = textureLoader.load('https://assets.codepen.io/16327/logo_1.png'); 

        // 4. SCORPIO CONSTELLATION DATA
        // I mapped these manually to look like the Scorpio shape in 3D space
        const scorpioStars = [
            new THREE.Vector3(0.5, 1.5, 0),    // Head 1
            new THREE.Vector3(0.2, 1.3, 0),    // Head 2
            new THREE.Vector3(-0.1, 1.1, 0),   // Head 3
            new THREE.Vector3(-0.3, 0.8, 0),   // Body Start
            new THREE.Vector3(-0.4, 0.4, 0),   // Body
            new THREE.Vector3(-0.4, 0.0, 0),   // Body
            new THREE.Vector3(-0.3, -0.4, 0),  // Body Curve
            new THREE.Vector3(0.0, -0.7, 0),   // Tail Start
            new THREE.Vector3(0.4, -0.8, 0),   // Tail Bottom
            new THREE.Vector3(0.7, -0.6, 0),   // Tail Up
            new THREE.Vector3(0.8, -0.3, 0),   // Stinger Base
            new THREE.Vector3(0.9, -0.1, 0)    // Stinger Tip
        ];

        let geometry = null;
        let material = null;
        let points = null;

        const generateGalaxy = () => {
            if(points !== null) {
                geometry.dispose();
                material.dispose();
                scene.remove(points);
            }

            geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(parameters.count * 3);
            const colors = new Float32Array(parameters.count * 3);

            const colorInside = new THREE.Color(parameters.insideColor);
            const colorOutside = new THREE.Color(parameters.outsideColor);

            // Create the Galaxy
            for(let i = 0; i < parameters.count; i++) {
                const i3 = i * 3;

                // --- SCORPIO LOGIC ---
                // We dedicate the first 1500 particles to form the Scorpio shape nicely
                const scorpioCount = 1500; 

                if (i < scorpioCount) {
                    // Pick a random star from the constellation array
                    const starTarget = scorpioStars[Math.floor(Math.random() * scorpioStars.length)];
                    
                    // Create a "cloud" around that star point so it glows
                    const spread = 0.15; // How tight the star cluster is
                    
                    positions[i3]     = starTarget.x + (Math.random() - 0.5) * spread;
                    positions[i3 + 1] = starTarget.y + (Math.random() - 0.5) * spread;
                    positions[i3 + 2] = starTarget.z + (Math.random() - 0.5) * spread;

                    // Color them bright orange/red
                    colors[i3]     = colorInside.r + 0.2;
                    colors[i3 + 1] = colorInside.g;
                    colors[i3 + 2] = colorInside.b;

                } else {
                    // --- GALAXY VORTEX LOGIC (Rest of particles) ---
                    const radius = Math.random() * parameters.radius;
                    const spinAngle = radius * parameters.spin;
                    const branchAngle = ((i % parameters.branches) / parameters.branches) * Math.PI * 2;

                    const randomX = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);
                    const randomY = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);
                    const randomZ = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);

                    // Offset X and Z so the galaxy surrounds the Scorpio in the middle
                    positions[i3]     = Math.cos(branchAngle + spinAngle) * radius + randomX;
                    positions[i3 + 1] = randomY; // Keep galaxy relatively flat
                    positions[i3 + 2] = Math.sin(branchAngle + spinAngle) * radius + randomZ;

                    // Mixed Colors
                    const mixedColor = colorInside.clone();
                    mixedColor.lerp(colorOutside, radius / parameters.radius);

                    colors[i3]     = mixedColor.r;
                    colors[i3 + 1] = mixedColor.g;
                    colors[i3 + 2] = mixedColor.b;
                }
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            // Material using the IMAGE TEXTURE
            material = new THREE.PointsMaterial({
                size: parameters.size,
                sizeAttenuation: true,
                depthWrite: false,
                blending: THREE.AdditiveBlending,
                vertexColors: true,
                map: particleTexture, // <--- This applies your image
                transparent: true,
                alphaTest: 0.001
            });

            points = new THREE.Points(geometry, material);
            scene.add(points);
        }

        generateGalaxy();

        // 5. SIZES & RESIZE
        const sizes = { width: window.innerWidth, height: window.innerHeight };

        window.addEventListener('resize', () => {
            sizes.width = window.innerWidth;
            sizes.height = window.innerHeight;
            camera.aspect = sizes.width / sizes.height;
            camera.updateProjectionMatrix();
            renderer.setSize(sizes.width, sizes.height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        });

        // 6. CAMERA
        const camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height, 0.1, 100);
        camera.position.set(0, 0, 4); // Start further back
        scene.add(camera);

        // 7. RENDERER
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
        renderer.setSize(sizes.width, sizes.height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        // 8. SCROLL ANIMATION LOGIC
        let scrollY = 0;
        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
            
            // Show final message at bottom
            const msg = document.getElementById('msg');
            if (scrollY > window.innerHeight * 1.5) {
                msg.style.opacity = 1;
            } else {
                msg.style.opacity = 0;
            }
        });

        // 9. ANIMATION LOOP
        const clock = new THREE.Clock();

        const tick = () => {
            const elapsedTime = clock.getElapsedTime();

            // --- AMAZING SCROLL EFFECT ---
            // 1. Galaxy rotates slowly naturally
            points.rotation.y = elapsedTime * 0.05;
            
            // 2. Scroll interaction:
            // Calculate scroll percentage (0 to 1)
            const maxScroll = document.body.scrollHeight - window.innerHeight;
            const scrollPercent = scrollY / maxScroll;

            // Camera moves closer to the Scorpio (Zoom In)
            // Starts at Z=4, ends at Z=1.5
            camera.position.z = 4 - (scrollPercent * 2.5);
            
            // Camera tilts slightly up to look at the constellation
            camera.position.y = scrollPercent * 0.5;

            // Constellation/Galaxy tilts to face user as they scroll
            points.rotation.x = scrollPercent * 0.5;

            renderer.render(scene, camera);
            window.requestAnimationFrame(tick);
        }

        tick();
    </script>
</body>
</html>
